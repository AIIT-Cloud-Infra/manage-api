# テスト手順書

## アカウントの登録
```sh
curl -X 'POST' http://localhost:3000/users/signup \
  -d 'email=a2040hm@aiit.ac.jp' \
  -d 'password=test12345'
```

## トークン発行
```sh
curl -X 'POST' http://localhost:3000/users/signin \
  -d 'email=a2040hm@aiit.ac.jp' \
  -d 'password=test12345' | jq
```

## VM起動イメージ一覧の表示
```sh
curl http://localhost:3000/base_imgs \
  -H 'X-AUTH-TOKEN: <token>' | jq
```

## VM起動
- メモリ: 1024
- CPU: 1
```sh
curl -X 'POST' http://localhost:3000/instances \
  -H 'X-AUTH-TOKEN: <token>' \
  -d 'base_img=centos7' \
  -d 'memory=1024' \
  -d 'cpu=1'
```

- メモリ: 2048
- CPU: 2
```sh
curl -X 'POST' http://localhost:3000/instances \
  -H 'X-AUTH-TOKEN: LAoXAwNCEAMtX915' \
  -d 'base_img=centos7' \
  -d 'memory=2048' \
  -d 'cpu=2'
```

## キャパシティオーバーの確認
```sh
curl -X 'POST' http://localhost:3000/instances \
  -H 'X-AUTH-TOKEN: <token>' \
  -d 'base_img=centos7' \
  -d 'memory=1024' \
  -d 'cpu=10' | jq
```

## MySQL内を確認
```sh
mysql -u apuser -p<password> master_db
> SELECT * FROM instances\G
```

## VM一覧の表示
```sh
curl http://localhost:3000/instances \
  -H 'X-AUTH-TOKEN: LAoXAwNCEAMtX915' | jq
```

## SSHキー取得
```sh
curl http://localhost:3000/instances/3414dd49-b703-46a3-9b6a-49c206f6cde3/ssh_key \
  -H 'X-AUTH-TOKEN: LAoXAwNCEAMtX915' | jq
```

## SSH接続
```sh
touch vm_1_rsa
chmod 0600 vm_1_rsa

```

## VM削除
```sh
curl -X 'DELETE' http://localhost:3000/instances/<uid> \
  -H 'X-AUTH-TOKEN: <token>'
```

## VM停止
```sh
curl -X 'POST' http://localhost:3000/instances/<uid>/stop \
  -H 'X-AUTH-TOKEN: <token>'
```

## VM再開
```sh
curl -X 'POST' http://localhost:3000/instances/<uid>/start \
  -H 'X-AUTH-TOKEN: <token>'
```
